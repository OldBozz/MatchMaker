@page "/Players"
@using MatchMakerLib.MatchMakerModel;
@using MatchMakerLib.Data;
@using Microsoft.EntityFrameworkCore;
@using MatcMakerLiteAPP.Pages.Dialogs;

@inject NavigationManager NavigationManager
@inject MatchMakerDbContext dbcontext
@inject IDialogService DialogService

<MudContainer Class="mt-4">
    <MudText Typo="Typo.h4" Class="mb-4" Align="Align.Center" GutterBottom="true">Players</MudText>
    <MudButton @onclick="OpenDialog" Variant="Variant.Filled" Color="Color.Primary">
        Add player
    </MudButton>

    <MudDataGrid T="Player" Items="@(dbcontext.Players.Include(players => players.Teams).ToList())" ReadOnly="false" EditMode="DataGridEditMode.Form"
                 CommittedItemChanges="@CommittedItemChanges"
                 Bordered="true" Dense="true" Hover="true" Striped="true" EditTrigger="DataGridEditTrigger.OnRowClick" SortMode="SortMode.None">
        <Columns>
            <PropertyColumn Property="x => x.Displayname" Title="Displayname"/>
            <PropertyColumn Property="x => x.Name" />
            <PropertyColumn Property="x => x.Dob">
                <EditTemplate>
                    <MudDatePicker Label="Date of Birth" @bind-Date="@context.Item.Dob" />
                </EditTemplate>
            </PropertyColumn>
             <PropertyColumn Property="x => x.Teams.Count" Title="No of teams"/>
            @*<PropertyColumn Property="x => x.Tournaments.Count" Title="No of tournaments" />*@
         
@*                    <PropertyColumn Property="x => x.Team1" IsEditable="false" />
            <PropertyColumn Property="x => x.Team1Points" Title="Points">
            <EditTemplate>
            <MudNumericField @bind-Value="@context.Item.Team1Points" Min="1" MaxLength="2" Label="@context.Item.Team1.Name" />
            </EditTemplate>
            </PropertyColumn>
            <PropertyColumn Property="x => x.Team2" IsEditable="false" CellStyleFunc="@_cellStyleFuncTeam2" />
            <PropertyColumn Property="x => x.Team2Points" Title="Points">
            <EditTemplate>
            <MudNumericField @bind-Value="@context.Item.Team2Points" Min="1" MaxLength="2" Label="@context.Item.Team2.Name" />
            </EditTemplate>
            </PropertyColumn>
            *@
        </Columns>
    </MudDataGrid>
</MudContainer>
@code {
    //List<Player> players =new();

    //protected override async Task OnInitializedAsync() => players = dbcontext.Players.ToList();

    List<Player> getPlayers()
    {
         //return dbcontext.Players.Include(players => players.Teams).ToList();
        return dbcontext.Players.ToList();
    }
    private async void OpenDialog()
    {
        //var options = new DialogOptions { CloseOnEscapeKey = true };
        //var parameters = new DialogParameters();
        //parameters.Add("Tournament", TournamentModel);
        var dialog = await DialogService.ShowAsync<PlayerEditDialog>("Edit Player");
        await dialog.Result;
        StateHasChanged();
    }

    void CommittedItemChanges(Player player)
    {
        //bool? result = await DialogService.ShowMessageBox(
        //      "Info",
        //      "CommittedItemChanges",
        //      yesText: "Delete!", cancelText: "Cancel");
        ////state = result == null ? "Canceled" : "Deleted!";

        //StateHasChanged();

    }
}
